h2. About Harmonia

Harmonia is a distributed storage engine based on Chord DHT algorithm.
It provides range query function over DHT storage layer.
It stores data with replication.

N.B.
Now, it is in alpha quality.

h2. Building and Installing 

Download, extract, and make

h2. Example

Harmonia quick execution

starts 5 virtual nodes on local machine:
<pre>
./test/test5.sh -s
</pre>

Then add a new virtual node to issue client commands:
<pre>
erl -pa ebin -config harmonia -run hm_edge start -harmonia node_type 'join' name xxx sname 'xxx_node@ubu' root_node 'node_foo@ubu' -setcookie harmonia_cookie -sname 'xxx_node@ubu'
</pre>

stops 5 virtual nodes on local machine:
<pre>
./test/test5.sh -q
</pre>



Harmonia Command

<pre>
Usage(start):hm -t [create|join -r root_name -w root_node@node] -n name -s sname@node [-c cookievalue]
Usage(stop ):hm -q -w root_node@node -s sname@node [-c cookievalue]
</pre>

Start each node with name foo, bar, etc.

<pre>
    hiro@ubu:~$ scripts/hm -t create -n foo -s node_foo@ubu -d
    hiro@ubu:~$ scripts/hm -t join -r foo -n bar  -s node_bar@ubu -w node_foo@ubu -d
    hiro@ubu:~$ scripts/hm -t join -r foo -n hoge -s node_hoge@ubu -w node_foo@ubu -d
    hiro@ubu:~$ scripts/hm -t join -r foo -n cat  -s node_cat@ubu -w node_foo@ubu -d
    hiro@ubu:~$ scripts/hm -t join -r foo -n dog  -s node_dog@ubu -w node_foo@ubu -d
</pre>

Stop Harmonia

<pre>
    hiro@ubu:~$ scripts/hm -q -w node_foo@ubu -s stop_test@ubu -d
</pre>

Make table as domain name is Domain1, table name is Tbl1, field names Fld1 and Fld2, etc, it returns node name on which table and its replicas were created. 

<pre>
    7> harmonia_table:make_table("Domain1", "Tbl1", [{"Fld1",true,true},{"Fld2",false, []}]).
</pre>

Retrieve table property

<pre>
    8> harmonia_table:get_table_info("Domain1", "Tbl1").
    {ok,36885,[{"Fld1",true,true},{"Fld2",false,[]}]}
</pre>


store data to Tbl1 in Domain1

<pre>
    9> harmonia_ds:store("Domain1", "Tbl1", [{"Fld1", key1},{"Fld2", value1}]).
    {ok,4}
    10> harmonia_ds:store("Domain1", "Tbl1", [{"Fld1", key2},{"Fld2", value2}]).
    {ok,4}
    11> harmonia_ds:store("Domain1", "Tbl1", [{"Fld1", key3},{"Fld2", value3}]).
    {ok,4}
</pre>

get data from Tbl1 in Domain1 with query condition Fld1 == key2

<pre>
    12> harmonia_ds:get("Domain1", "Tbl1", "Fld1 == key2").
    {ok,[['Domain1Tbl1',key2,value2]]}
</pre>


Another example of making table

<pre>
    13> harmonia_table:make_table("Domain1", "Tbl2", [{"Fld1",true,true},{"Fld2",true,true},{"Fld3",false,nil}]).
    {ok,{[{harmonia_cat,instance},
          {harmonia_dog,238},
          {harmonia_foo,95},
          {harmonia_hoge,196},
          {harmonia_bar,106}],
         []}}
</pre>

Another example of get table info

<pre>
    14> harmonia_table:get_table_info("Domain1", "Tbl2").
    {ok,53273,
        [{"Fld1",true,true},{"Fld2",true,true},{"Fld3",false,nil}]}
</pre>

Another example of store data

<pre>
    15> harmonia_ds:store("Domain1", "Tbl2", [{"Fld1", xxx},{"Fld2", 32},{"Fld3", textfile1}]).
    {ok,5}
    16> harmonia_ds:store("Domain1", "Tbl2", [{"Fld1", yyy},{"Fld2", 150},{"Fld3", textfile1}]).
    {ok,5}
    17> harmonia_ds:store("Domain1", "Tbl2", [{"Fld1", zzz},{"Fld2", 3000},{"Fld3", textfile1}]).
    {ok,5}
</pre>

Another example of get data with range query

<pre>
    18> harmonia_ds:get("Domain1", "Tbl2", "Fld1 == yyy or Fld2 == 32").
    {ok,[['Domain1Tbl2',xxx,32,textfile1],
         ['Domain1Tbl2',yyy,150,textfile1]]}
    19> harmonia_ds:get("Domain1", "Tbl2", "Fld1 == yyy and Fld2 == 150").
    {ok,[['Domain1Tbl2',yyy,150,textfile1]]}
    20> 
</pre>

h2. Algorithm

Harmonia is based on Chord algorithm, and it builds index on top of that, hence provides range query function.
Ref: "http://pdos.csail.mit.edu/chord/":http://pdos.csail.mit.edu/chord/

h2. Author

Copyright (C) Yoshihiro TANAKA
Written by Yoshihiro TANAKA <hirotnkg@gmail.com>

h2. License

Apache 2.0 License
"http://www.apache.org/licenses/":http://www.apache.org/licenses/

